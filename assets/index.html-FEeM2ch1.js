import{_ as n,c as a,b as e,o as l}from"./app-Bn9GZJrW.js";const i={};function t(p,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h1><div class="hint-container caution"><p class="hint-container-title">Caution</p><p>Documentation here is over 8 years old! The approach is not presently maintained, however updating it to work, or taking a similar more modern approach, should still be feasible.</p></div><p>The approach assumed:</p><ul><li>You are deploying with <a href="https://capistranorb.com/" target="_blank" rel="noopener noreferrer">Capistrano.</a></li><li>You have two machines, &quot;deploy&quot; and &quot;server&quot;, in this example both are Ubuntu 14.04(+) LTS (not 14.10)</li><li>You are resonably capable with a command line environment*</li><li>You have &quot;provisioned&quot; production with the pertinent shell script</li><li>Your &quot;deploy&quot; machine has Ruby, bundler and rubygems installed</li><li>You can ssh without password to your &quot;server&quot;</li><li>Instructions containing all cap values are variables that you must replace (e.g. USERNAME)</li><li>Configure &quot;Server&quot; first, &quot;Deploy&quot; second</li></ul><h2 id="the-server" tabindex="-1"><a class="header-anchor" href="#the-server"><span>The Server</span></a></h2><p>Thanks to <a href="https://robmclarty.com/words/articles/how_to_deploy_a_rails_4_app_with_git_and_capistrano/" target="_blank" rel="noopener noreferrer">Rob Mclarty&#39;s blog post</a> for the general strategy.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Ensure that you can login via ssh with the user that will deploy taxonworks, you can find many places to describe howto set this up.</p></div><p>A shell script to configure the Server (note the very outdated version) was something like:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Target is Ubuntu 14.04</span></span>
<span class="line"></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> update</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Build environment</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">git</span> gcc nodejs build-essential libffi-dev libgdbm-dev libncurses5-dev libreadline-dev libssl-dev libyaml-dev zlib1g-dev libcurl4-openssl-dev </span>
<span class="line"></span>
<span class="line"><span class="token comment"># Postgres</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> libpq-dev libproj-dev libgeos-dev libgeos++-dev postgis* postgresql</span>
<span class="line"></span>
<span class="line"><span class="token comment">#  ImageMagick</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> pkg-config imagemagick libmagickcore-dev libmagickwand-dev </span>
<span class="line"></span>
<span class="line"><span class="token comment"># Tesseract</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> tesseract-ocr</span>
<span class="line"></span>
<span class="line"><span class="token comment"># cmake</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> cmake</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Rbenv  </span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/sstephenson/rbenv.git ~/.rbenv</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;eval &quot;$(rbenv init -)&quot;&#39;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc</span>
<span class="line"><span class="token function">git</span> clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">source</span> ~/.bashrc</span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">CONFIGURE_OPTS</span><span class="token operator">=</span><span class="token string">&quot;--with-readline-dir=/usr/include/readline&quot;</span> rbenv <span class="token function">install</span> <span class="token number">2.3</span>.1 </span>
<span class="line">rbenv global <span class="token number">2.3</span>.1</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Bundler</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> bundler</span>
<span class="line"></span>
<span class="line">rbenv <span class="token builtin class-name">exec</span> gem <span class="token function">install</span> bundler  --no-ri --no-rdoc</span>
<span class="line">rbenv rehash</span>
<span class="line"></span>
<span class="line"><span class="token comment"># apt-get Passenger config</span></span>
<span class="line"><span class="token comment"># https://www.phusionpassenger.com/documentation/Users%20guide%20Nginx.html#install_on_debian_ubuntu</span></span>
<span class="line"><span class="token function">sudo</span> apt-key adv <span class="token parameter variable">--keyserver</span> keyserver.ubuntu.com --recv-keys 561F9B9CAC40B2F7</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apt-transport-https ca-certificates</span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main&#39;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/passenger.list  <span class="token operator">&gt;</span> /dev/null</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> root: /etc/apt/sources.list.d/passenger.list</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">655</span> /etc/apt/sources.list.d/passenger.list</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> update</span>
<span class="line"></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx-extras passenger</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Manually complete:</span></span>
<span class="line"><span class="token comment"># Edit /etc/nginx/nginx.conf and uncomment passenger_root and passenger_ruby. </span></span>
<span class="line"><span class="token comment"># sudo service nginx restart</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="add-a-group" tabindex="-1"><a class="header-anchor" href="#add-a-group"><span>Add a group</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sudo groupadd deployers</span>
<span class="line">sudo usermod -a -G deployers USERNAME </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sudo mkdir /var/www</span>
<span class="line">sudo mkdir /var/www/taxonworks</span>
<span class="line">sudo mkdir /var/www/taxonworks/shared</span>
<span class="line">sudo mkdir var/www/taxonworks/shared/config/</span>
<span class="line">sudo chown -R USERNAME:deployers /var/www</span>
<span class="line">sudo chmod -R g+w /var/www</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="configure-postgres" tabindex="-1"><a class="header-anchor" href="#configure-postgres"><span>Configure postgres</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sudo -u postgres psql postgres</span>
<span class="line"></span>
<span class="line">alter user postgres with password &#39;PASSWORD1&#39;;</span>
<span class="line">create role taxonworks_production login createdb superuser;</span>
<span class="line">alter user taxonworks_production with password &#39;PASSWORD2&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Configure nginx to point to your passenger ruby, in <code>/etc/nginx/nginx.conf</code> add/edit the line (change USERNAME!):</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  passenger_ruby /home/USERNAME/.rbenv/shims/ruby;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Set permissions for nginx</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sudo chmod g+x,o+x /var/www/taxonworks/current/config.ru</span>
<span class="line">sudo chmod g+x,o+x /var/www/taxonworks</span>
<span class="line">sudo chmod g+x,o+x /var/www</span>
<span class="line">sudo chmod g+x,o+x /var/www/taxonworks/current/public</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Create nginx site</p><ul><li>Add an an available site to /etc/nginx/sites-enabled (see example here)</li><li>Within /etc/nginx/sites-avaiable create a symbolic link</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sudo ln -ls ../sites-available/taxonworks taxonworks</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="on-deploy" tabindex="-1"><a class="header-anchor" href="#on-deploy"><span>On &quot;Deploy&quot;</span></a></h2><h4 id="clone-the-master-branch-of-taxonworks" tabindex="-1"><a class="header-anchor" href="#clone-the-master-branch-of-taxonworks"><span>Clone the master branch of TaxonWorks.</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  git clone https://github.com/SpeciesFileGroup/taxonworks.git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="install-capistrano" tabindex="-1"><a class="header-anchor" href="#install-capistrano"><span>Install capistrano</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  gem install capistrano</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="create-a-new-branch-inside-your-taxonworks-folder" tabindex="-1"><a class="header-anchor" href="#create-a-new-branch-inside-your-taxonworks-folder"><span>Create a new branch, inside your taxonworks folder:</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  git branch capistrano</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="checkout-that-branch" tabindex="-1"><a class="header-anchor" href="#checkout-that-branch"><span>Checkout that branch</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  git checkout capistrano</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="run-capistrano-to-setup-capify-taxonworks" tabindex="-1"><a class="header-anchor" href="#run-capistrano-to-setup-capify-taxonworks"><span>Run capistrano to setup &quot;capify&quot; taxonworks</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"> bundle exec cap install</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This creates a <code>config/deploy</code> directory, and some sample files.</p><h4 id="configure-the-capistrano-files" tabindex="-1"><a class="header-anchor" href="#configure-the-capistrano-files"><span>Configure the capistrano files</span></a></h4><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre><code><span class="line"></span>
<span class="line"><span class="token comment"># config/deploy.rb</span></span>
<span class="line"></span>
<span class="line">lock <span class="token string-literal"><span class="token string">&#39;3.4.0&#39;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#set :rbenv_type, :user</span></span>
<span class="line"></span>
<span class="line">set <span class="token symbol">:rbenv_ruby</span><span class="token punctuation">,</span> <span class="token builtin">File</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;.ruby-version&#39;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip</span>
<span class="line">set <span class="token symbol">:application</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&#39;taxonworks&#39;</span></span></span>
<span class="line">set <span class="token symbol">:repo_url</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&#39;git@github.com:SpeciesFileGroup/taxonworks.git&#39;</span></span></span>
<span class="line"></span>
<span class="line">set <span class="token symbol">:linked_files</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">%w{config/database.yml config/application_settings.yml config/secrets.yml}</span></span></span>
<span class="line">set <span class="token symbol">:linked_dirs</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">%w{bin log tmp/pids tmp/cache tmp/sockets vendor/bundle public/system public/images/tmp}</span></span></span>
<span class="line"></span>
<span class="line">namespace <span class="token symbol">:deploy</span> <span class="token keyword">do</span></span>
<span class="line"></span>
<span class="line">  desc <span class="token string-literal"><span class="token string">&#39;Restart application&#39;</span></span></span>
<span class="line">  task <span class="token symbol">:restart</span> <span class="token keyword">do</span></span>
<span class="line">    on roles<span class="token punctuation">(</span><span class="token symbol">:app</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token symbol">in</span><span class="token operator">:</span> <span class="token symbol">:sequence</span><span class="token punctuation">,</span> <span class="token symbol">wait</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token keyword">do</span></span>
<span class="line">      <span class="token comment"># Your restart mechanism here, for example:</span></span>
<span class="line">      <span class="token comment"># run &quot;touch #{current_release}/tmp/restart.txt&quot;</span></span>
<span class="line">       execute <span class="token symbol">:touch</span><span class="token punctuation">,</span> release_path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&#39;tmp/restart.txt&#39;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">  after <span class="token symbol">:publishing</span><span class="token punctuation">,</span> <span class="token symbol">:restart</span></span>
<span class="line"></span>
<span class="line">  after <span class="token symbol">:restart</span><span class="token punctuation">,</span> <span class="token symbol">:clear_cache</span> <span class="token keyword">do</span></span>
<span class="line">    on roles<span class="token punctuation">(</span><span class="token symbol">:web</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token symbol">in</span><span class="token operator">:</span> <span class="token symbol">:groups</span><span class="token punctuation">,</span> <span class="token symbol">limit</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token symbol">wait</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token keyword">do</span></span>
<span class="line">      <span class="token comment"># Here we can do anything such as:</span></span>
<span class="line">      <span class="token comment"># within release_path do</span></span>
<span class="line">      <span class="token comment">#   execute :rake, &#39;cache:clear&#39;</span></span>
<span class="line">      <span class="token comment"># end</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">namespace <span class="token symbol">:setup</span> <span class="token keyword">do</span></span>
<span class="line"></span>
<span class="line">  desc <span class="token string-literal"><span class="token string">&quot;Check that we can access everything&quot;</span></span></span>
<span class="line">  task <span class="token symbol">:check_write_permissions</span> <span class="token keyword">do</span></span>
<span class="line">    on roles<span class="token punctuation">(</span><span class="token symbol">:all</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>host<span class="token operator">|</span></span>
<span class="line">      <span class="token keyword">if</span> test<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;[ -w </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">fetch<span class="token punctuation">(</span><span class="token symbol">:deploy_to</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">}</span></span><span class="token string"> ]&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        info <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">fetch<span class="token punctuation">(</span><span class="token symbol">:deploy_to</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">}</span></span><span class="token string"> is writable on </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">host</span><span class="token delimiter punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">      <span class="token keyword">else</span></span>
<span class="line">        error <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">fetch<span class="token punctuation">(</span><span class="token symbol">:deploy_to</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">}</span></span><span class="token string"> is not writable on </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">host</span><span class="token delimiter punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">      <span class="token keyword">end</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line">  desc <span class="token string-literal"><span class="token string">&quot;Upload database.yml file.&quot;</span></span></span>
<span class="line">  task <span class="token symbol">:upload_yml</span> <span class="token keyword">do</span></span>
<span class="line">    on roles<span class="token punctuation">(</span><span class="token symbol">:app</span><span class="token punctuation">)</span> <span class="token keyword">do</span></span>
<span class="line">      execute <span class="token string-literal"><span class="token string">&quot;mkdir -p </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">shared_path</span><span class="token delimiter punctuation">}</span></span><span class="token string">/config&quot;</span></span></span>
<span class="line">      upload<span class="token operator">!</span> <span class="token class-name">StringIO</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;config/database.yml&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">shared_path</span><span class="token delimiter punctuation">}</span></span><span class="token string">/config/database.yml&quot;</span></span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line">  <span class="token keyword">end</span></span>
<span class="line">  </span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Minimally, modify <code>production.rb</code> to point to your machine, and to use your USERNAME:</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre><code><span class="line"><span class="token comment"># production.rb</span></span>
<span class="line"></span>
<span class="line">set <span class="token symbol">:stage</span><span class="token punctuation">,</span> <span class="token symbol">:production</span></span>
<span class="line">set <span class="token symbol">:deploy_to</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&#39;/var/www/taxonworks&#39;</span></span></span>
<span class="line">set <span class="token symbol">:user</span><span class="token punctuation">,</span> fetch<span class="token punctuation">(</span><span class="token symbol">:remote_user</span><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment"># EDIT THIS LINE: </span></span>
<span class="line">server <span class="token string-literal"><span class="token string">&#39;your.server.org&#39;</span></span><span class="token punctuation">,</span> <span class="token symbol">roles</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">%w{app web db}</span></span><span class="token punctuation">,</span> <span class="token symbol">user</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">&#39;username_from_production&#39;</span></span><span class="token punctuation">,</span> <span class="token symbol">primary</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">set <span class="token symbol">:use_sudo</span><span class="token punctuation">,</span> <span class="token boolean">false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Add something like this to your nginx/sites-available/taxonworks file on your server:</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx" data-title="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span> default_server</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token directive"><span class="token keyword">server_name</span> your.server.name.or.ip</span><span class="token punctuation">;</span> </span>
<span class="line">  <span class="token directive"><span class="token keyword">passenger_enabled</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token directive"><span class="token keyword">passenger_app_env</span> production</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token directive"><span class="token keyword">root</span> /var/www/taxonworks/current/public</span><span class="token punctuation">;</span> </span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="copy-config-files" tabindex="-1"><a class="header-anchor" href="#copy-config-files"><span>Copy config files</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">scp config/database.yml USERNAME@SERVERNAME:/var/www/taxonworks/shared/config/database.yml</span>
<span class="line">scp config/application_settings.yml USERNAME@SERVERNAME:/var/www/taxonworks/shared/config/application_settings.yml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="deploy" tabindex="-1"><a class="header-anchor" href="#deploy"><span>Deploy</span></a></h4><p>Inside your taxonworks directory, with the capistrano branch checkout out</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cap production deploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,44)]))}const c=n(i,[["render",t],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/develop/Install/Production/Capistrano/","title":"Overview","lang":"en-US","frontmatter":{"sidebarPosition":3,"sidebarParentPosition":3},"headers":[{"level":2,"title":"The Server","slug":"the-server","link":"#the-server","children":[{"level":4,"title":"Add a group","slug":"add-a-group","link":"#add-a-group","children":[]},{"level":4,"title":"Configure postgres","slug":"configure-postgres","link":"#configure-postgres","children":[]}]},{"level":2,"title":"On \\"Deploy\\"","slug":"on-deploy","link":"#on-deploy","children":[{"level":4,"title":"Clone the master branch of TaxonWorks.","slug":"clone-the-master-branch-of-taxonworks","link":"#clone-the-master-branch-of-taxonworks","children":[]},{"level":4,"title":"Install capistrano","slug":"install-capistrano","link":"#install-capistrano","children":[]},{"level":4,"title":"Create a new branch, inside your taxonworks folder:","slug":"create-a-new-branch-inside-your-taxonworks-folder","link":"#create-a-new-branch-inside-your-taxonworks-folder","children":[]},{"level":4,"title":"Checkout that branch","slug":"checkout-that-branch","link":"#checkout-that-branch","children":[]},{"level":4,"title":"Run capistrano to setup \\"capify\\" taxonworks","slug":"run-capistrano-to-setup-capify-taxonworks","link":"#run-capistrano-to-setup-capify-taxonworks","children":[]},{"level":4,"title":"Configure the capistrano files","slug":"configure-the-capistrano-files","link":"#configure-the-capistrano-files","children":[]},{"level":4,"title":"Copy config files","slug":"copy-config-files","link":"#copy-config-files","children":[]},{"level":4,"title":"Deploy","slug":"deploy","link":"#deploy","children":[]}]}],"git":{"updatedTime":1730999918000,"contributors":[{"name":"mjy","email":"diapriid@gmail.com","commits":1,"url":"https://github.com/mjy"}]},"filePathRelative":"develop/Install/Production/Capistrano/README.md"}');export{c as comp,r as data};
